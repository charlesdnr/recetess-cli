<!-- components/recipe-detail/recipe-detail.component.html -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="container" *ngIf="recipe">
  <div class="back-navigation">
    <a [routerLink]="['/category', recipe.category, recipe.subcategory]" class="back-link">
      <i class="pi pi-arrow-left"></i> Retour à {{ recipe.subcategory || recipe.category }}
    </a>
  </div>

  <p-card>
    <ng-template pTemplate="header">
      <div class="recipe-header">
        <div class="recipe-title">
          <h1>{{ recipe.title }}</h1>
          <div class="recipe-tags">
            @for (tag of recipe.tags; track $index) {
              <p-tag value="{{ tag }}"></p-tag>
            }
          </div>
        </div>
        <div class="recipe-actions">
          <p-button icon="pi pi-print" styleClass="p-button-text" (click)="showPrintPreview()" pTooltip="Imprimer"></p-button>
          <p-button icon="pi pi-pencil" styleClass="p-button-text" [routerLink]="['/edit-recipe', recipe.id]" pTooltip="Modifier"></p-button>
          <p-button icon="pi pi-trash" styleClass="p-button-text p-button-danger" (click)="deleteRecipe()" pTooltip="Supprimer"></p-button>
        </div>
      </div>
    </ng-template>

    <div class="recipe-meta">
      <div class="meta-item">
        <i class="pi pi-clock"></i>
        <div class="meta-content">
          <span class="meta-label">Préparation</span>
          <span class="meta-value">{{ recipe.prepTime }} min</span>
        </div>
      </div>
      <div class="meta-item">
        <i class="pi pi-clock"></i>
        <div class="meta-content">
          <span class="meta-label">Cuisson</span>
          <span class="meta-value">{{ recipe.cookTime }} min</span>
        </div>
      </div>
      <div class="meta-item">
        <i class="pi pi-users"></i>
        <div class="meta-content">
          <span class="meta-label">Personnes</span>
          <span class="meta-value">{{ recipe.servings }}</span>
        </div>
      </div>
      <div class="meta-item">
        <i class="pi pi-star"></i>
        <div class="meta-content">
          <span class="meta-label">Difficulté</span>
          <span class="meta-value">{{ recipe.difficulty }}</span>
        </div>
      </div>
    </div>

    <p-divider></p-divider>

    <div class="recipe-content">
      <div class="recipe-image">
        <div class="recipe-image">
          <img [src]="getFullImageUrl(recipe.imageUrl)" [alt]="recipe.title">
          </div>
      </div>

      <div class="recipe-description">
        <p>{{ recipe.description }}</p>
      </div>

      <p-tabView>
        <p-tabPanel header="Ingrédients">
          <div class="ingredients-list">
            @for (ingredient of recipe.ingredients; track $index) {
              <div class="ingredient-item">
                <i class="pi pi-check-circle"></i>
                <span>{{ ingredient }}</span>
              </div>
            }
          </div>
        </p-tabPanel>

        <p-tabPanel header="Préparation">
          <div class="steps-list">
            @for (step of recipe.steps; track $index) {
              <div class="step-item">
                <div class="step-number">{{ $index + 1 }}</div>
                <div class="step-text">{{ step }}</div>
              </div>
            }
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>
  </p-card>
</div>

<div class="loading" *ngIf="!recipe">
  <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
  <p>Chargement de la recette...</p>
</div>

<p-dialog [(visible)]="showPrintDialog" header="Aperçu avant impression" [modal]="true" [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">
  <div class="print-preview">
    <h2>{{ recipe?.title }}</h2>
    <div class="print-meta">
      <span>Préparation: {{ recipe?.prepTime }} min</span>
      <span>Cuisson: {{ recipe?.cookTime }} min</span>
      <span>Personnes: {{ recipe?.servings }}</span>
      <span>Difficulté: {{ recipe?.difficulty }}</span>
    </div>
    <div class="print-ingredients">
      <h3>Ingrédients</h3>
      <ul>
        @for (ingredient of recipe?.ingredients; track $index) {
          <li>{{ ingredient }}</li>
        }
      </ul>
    </div>
    <div class="print-steps">
      <h3>Préparation</h3>
      <ol>
        @for (step of recipe?.steps; track $index) {
          <li>{{ step }}</li>
        }
      </ol>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button icon="pi pi-print" label="Imprimer" (click)="printRecipe()"></p-button>
    <p-button icon="pi pi-times" label="Annuler" styleClass="p-button-text" (click)="showPrintDialog = false"></p-button>
  </ng-template>
</p-dialog>